name: Build KernelSU for gauguin (Fixed)

on: workflow_dispatch

jobs:
  build:
    runs-on: ubuntu-latest
    
    steps:
    - name: Get LineageOS kernel
      run: |
        git clone --depth=1 https://github.com/LineageOS/android_kernel_xiaomi_gauguin -b lineage-23.0
        
    - name: Apply KernelSU for 4.19
      run: |
        cd android_kernel_xiaomi_gauguin

        wget https://raw.githubusercontent.com/tiann/KernelSU/main/kernel/patches/4.19.patch
        patch -p1 < 4.19.patch || echo "补丁可能部分失败，继续..."

        echo "CONFIG_KSU=y" >> arch/arm64/configs/vendor/xiaomi/gauguin.config
        
    - name: Build kernel
      run: |
        cd android_kernel_xiaomi_gauguin
        export ARCH=arm64 CROSS_COMPILE=aarch64-linux-gnu-
        make vendor/xiaomi/gauguin.config
        make -j$(nproc) Image
